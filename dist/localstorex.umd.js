(function(y,S){typeof exports=="object"&&typeof module<"u"?S(exports):typeof define=="function"&&define.amd?define(["exports"],S):(y=typeof globalThis<"u"?globalThis:y||self,S(y.LocalStoreX={}))})(this,function(y){"use strict";var $=Object.defineProperty;var z=(y,S,x)=>S in y?$(y,S,{enumerable:!0,configurable:!0,writable:!0,value:x}):y[S]=x;var F=(y,S,x)=>z(y,typeof S!="symbol"?S+"":S,x);function S(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var x={exports:{}},B={exports:{}};(function(){var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a={rotl:function(o,s){return o<<s|o>>>32-s},rotr:function(o,s){return o<<32-s|o>>>s},endian:function(o){if(o.constructor==Number)return a.rotl(o,8)&16711935|a.rotl(o,24)&4278255360;for(var s=0;s<o.length;s++)o[s]=a.endian(o[s]);return o},randomBytes:function(o){for(var s=[];o>0;o--)s.push(Math.floor(Math.random()*256));return s},bytesToWords:function(o){for(var s=[],c=0,l=0;c<o.length;c++,l+=8)s[l>>>5]|=o[c]<<24-l%32;return s},wordsToBytes:function(o){for(var s=[],c=0;c<o.length*32;c+=8)s.push(o[c>>>5]>>>24-c%32&255);return s},bytesToHex:function(o){for(var s=[],c=0;c<o.length;c++)s.push((o[c]>>>4).toString(16)),s.push((o[c]&15).toString(16));return s.join("")},hexToBytes:function(o){for(var s=[],c=0;c<o.length;c+=2)s.push(parseInt(o.substr(c,2),16));return s},bytesToBase64:function(o){for(var s=[],c=0;c<o.length;c+=3)for(var l=o[c]<<16|o[c+1]<<8|o[c+2],h=0;h<4;h++)c*8+h*6<=o.length*8?s.push(f.charAt(l>>>6*(3-h)&63)):s.push("=");return s.join("")},base64ToBytes:function(o){o=o.replace(/[^A-Z0-9+\/]/ig,"");for(var s=[],c=0,l=0;c<o.length;l=++c%4)l!=0&&s.push((f.indexOf(o.charAt(c-1))&Math.pow(2,-2*l+8)-1)<<l*2|f.indexOf(o.charAt(c))>>>6-l*2);return s}};B.exports=a})();var A=B.exports,T={utf8:{stringToBytes:function(f){return T.bin.stringToBytes(unescape(encodeURIComponent(f)))},bytesToString:function(f){return decodeURIComponent(escape(T.bin.bytesToString(f)))}},bin:{stringToBytes:function(f){for(var a=[],o=0;o<f.length;o++)a.push(f.charCodeAt(o)&255);return a},bytesToString:function(f){for(var a=[],o=0;o<f.length;o++)a.push(String.fromCharCode(f[o]));return a.join("")}}},E=T;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var H=function(f){return f!=null&&(w(f)||D(f)||!!f._isBuffer)};function w(f){return!!f.constructor&&typeof f.constructor.isBuffer=="function"&&f.constructor.isBuffer(f)}function D(f){return typeof f.readFloatLE=="function"&&typeof f.slice=="function"&&w(f.slice(0,0))}(function(){var f=A,a=E.utf8,o=H,s=E.bin,c=function(l,h){l.constructor==String?h&&h.encoding==="binary"?l=s.stringToBytes(l):l=a.stringToBytes(l):o(l)?l=Array.prototype.slice.call(l,0):!Array.isArray(l)&&l.constructor!==Uint8Array&&(l=l.toString());for(var i=f.bytesToWords(l),m=l.length*8,r=1732584193,t=-271733879,n=-1732584194,e=271733878,u=0;u<i.length;u++)i[u]=(i[u]<<8|i[u]>>>24)&16711935|(i[u]<<24|i[u]>>>8)&4278255360;i[m>>>5]|=128<<m%32,i[(m+64>>>9<<4)+14]=m;for(var p=c._ff,g=c._gg,d=c._hh,v=c._ii,u=0;u<i.length;u+=16){var _=r,J=t,M=n,U=e;r=p(r,t,n,e,i[u+0],7,-680876936),e=p(e,r,t,n,i[u+1],12,-389564586),n=p(n,e,r,t,i[u+2],17,606105819),t=p(t,n,e,r,i[u+3],22,-1044525330),r=p(r,t,n,e,i[u+4],7,-176418897),e=p(e,r,t,n,i[u+5],12,1200080426),n=p(n,e,r,t,i[u+6],17,-1473231341),t=p(t,n,e,r,i[u+7],22,-45705983),r=p(r,t,n,e,i[u+8],7,1770035416),e=p(e,r,t,n,i[u+9],12,-1958414417),n=p(n,e,r,t,i[u+10],17,-42063),t=p(t,n,e,r,i[u+11],22,-1990404162),r=p(r,t,n,e,i[u+12],7,1804603682),e=p(e,r,t,n,i[u+13],12,-40341101),n=p(n,e,r,t,i[u+14],17,-1502002290),t=p(t,n,e,r,i[u+15],22,1236535329),r=g(r,t,n,e,i[u+1],5,-165796510),e=g(e,r,t,n,i[u+6],9,-1069501632),n=g(n,e,r,t,i[u+11],14,643717713),t=g(t,n,e,r,i[u+0],20,-373897302),r=g(r,t,n,e,i[u+5],5,-701558691),e=g(e,r,t,n,i[u+10],9,38016083),n=g(n,e,r,t,i[u+15],14,-660478335),t=g(t,n,e,r,i[u+4],20,-405537848),r=g(r,t,n,e,i[u+9],5,568446438),e=g(e,r,t,n,i[u+14],9,-1019803690),n=g(n,e,r,t,i[u+3],14,-187363961),t=g(t,n,e,r,i[u+8],20,1163531501),r=g(r,t,n,e,i[u+13],5,-1444681467),e=g(e,r,t,n,i[u+2],9,-51403784),n=g(n,e,r,t,i[u+7],14,1735328473),t=g(t,n,e,r,i[u+12],20,-1926607734),r=d(r,t,n,e,i[u+5],4,-378558),e=d(e,r,t,n,i[u+8],11,-2022574463),n=d(n,e,r,t,i[u+11],16,1839030562),t=d(t,n,e,r,i[u+14],23,-35309556),r=d(r,t,n,e,i[u+1],4,-1530992060),e=d(e,r,t,n,i[u+4],11,1272893353),n=d(n,e,r,t,i[u+7],16,-155497632),t=d(t,n,e,r,i[u+10],23,-1094730640),r=d(r,t,n,e,i[u+13],4,681279174),e=d(e,r,t,n,i[u+0],11,-358537222),n=d(n,e,r,t,i[u+3],16,-722521979),t=d(t,n,e,r,i[u+6],23,76029189),r=d(r,t,n,e,i[u+9],4,-640364487),e=d(e,r,t,n,i[u+12],11,-421815835),n=d(n,e,r,t,i[u+15],16,530742520),t=d(t,n,e,r,i[u+2],23,-995338651),r=v(r,t,n,e,i[u+0],6,-198630844),e=v(e,r,t,n,i[u+7],10,1126891415),n=v(n,e,r,t,i[u+14],15,-1416354905),t=v(t,n,e,r,i[u+5],21,-57434055),r=v(r,t,n,e,i[u+12],6,1700485571),e=v(e,r,t,n,i[u+3],10,-1894986606),n=v(n,e,r,t,i[u+10],15,-1051523),t=v(t,n,e,r,i[u+1],21,-2054922799),r=v(r,t,n,e,i[u+8],6,1873313359),e=v(e,r,t,n,i[u+15],10,-30611744),n=v(n,e,r,t,i[u+6],15,-1560198380),t=v(t,n,e,r,i[u+13],21,1309151649),r=v(r,t,n,e,i[u+4],6,-145523070),e=v(e,r,t,n,i[u+11],10,-1120210379),n=v(n,e,r,t,i[u+2],15,718787259),t=v(t,n,e,r,i[u+9],21,-343485551),r=r+_>>>0,t=t+J>>>0,n=n+M>>>0,e=e+U>>>0}return f.endian([r,t,n,e])};c._ff=function(l,h,i,m,r,t,n){var e=l+(h&i|~h&m)+(r>>>0)+n;return(e<<t|e>>>32-t)+h},c._gg=function(l,h,i,m,r,t,n){var e=l+(h&m|i&~m)+(r>>>0)+n;return(e<<t|e>>>32-t)+h},c._hh=function(l,h,i,m,r,t,n){var e=l+(h^i^m)+(r>>>0)+n;return(e<<t|e>>>32-t)+h},c._ii=function(l,h,i,m,r,t,n){var e=l+(i^(h|~m))+(r>>>0)+n;return(e<<t|e>>>32-t)+h},c._blocksize=16,c._digestsize=16,x.exports=function(l,h){if(l==null)throw new Error("Illegal argument "+l);var i=f.wordsToBytes(c(l,h));return h&&h.asBytes?i:h&&h.asString?s.bytesToString(i):f.bytesToHex(i)}})();var N=x.exports;const C=S(N);class V{constructor(){F(this,"isDeep",!1)}setDeepTraversal(a){this.isDeep=a}generateVersionHash(a){const o=this.sortObject(a);return C(JSON.stringify(o))}sortObject(a){if(Array.isArray(a))return a.map(o=>this.sortObject(o));if(typeof a=="object"&&a!==null){const o={};return Object.keys(a).sort().forEach(s=>{o[s]=this.isDeep?this.sortObject(a[s]):a[s]}),o}return a}}const I=class I{constructor(a=I.defaultVersionHelper){this.objectVersionHelper=a,this.cleanupExpiredItems()}static getInstance(){return I.instance||(I.instance=new I),I.instance}setItem(a,o,s,c){const l=this.getVersion(o,c),h=this.getExistingItem(a)??this.createNewItem(l,s);this.updateOrAddValue(h,l,o),this.updateCurrentVersion(h,l,s),localStorage.setItem(a,JSON.stringify(h))}getItem(a,o){const s=this.getExistingItem(a);if(!s||this.isExpired(s.expiration))return localStorage.removeItem(a),null;const c=this.getVersion(s.values,o),l=this.findStoredValue(s.values,c);return l?l.data:null}removeItem(a){localStorage.removeItem(a)}clear(){localStorage.clear()}removeVersionItem(a,o){const s=this.getExistingItem(a);s&&(s.values=s.values.filter(c=>c.version!==o),s.values.length===0?this.removeItem(a):(s.currentVersion=s.values[s.values.length-1].version,localStorage.setItem(a,JSON.stringify(s))))}getExistingItem(a){const o=localStorage.getItem(a);return o?JSON.parse(o):null}createNewItem(a,o){return{currentVersion:a,expiration:o?Date.now()+o*36e5:null,values:[]}}updateOrAddValue(a,o,s){const c=a.values.find(l=>l.version===o);c?c.data=s:a.values.push({version:o,data:s})}updateCurrentVersion(a,o,s){a.currentVersion=o,a.expiration=s?Date.now()+s*36e5:a.expiration}getVersion(a,o){return typeof o=="string"?o:o instanceof V?o.generateVersionHash(a):this.objectVersionHelper.generateVersionHash(a)}isExpired(a){return a!==null&&Date.now()>a}cleanupExpiredItems(){for(let a=0;a<localStorage.length;a++){const o=localStorage.key(a);if(o){const s=localStorage.getItem(o);if(s)try{const c=JSON.parse(s);this.isExpired(c.expiration)&&localStorage.removeItem(o)}catch{console.warn(`Invalid JSON data for key "${o}": ${s}`),localStorage.removeItem(o)}}}}findStoredValue(a,o){return a.find(s=>s.version===o)}};F(I,"instance"),F(I,"defaultVersionHelper",new V);let O=I;y.LocalStoreX=O,y.ObjectVersionHelper=V,Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});
