{"version":3,"file":"localstorex.es.js","sources":["../src/type/TypeGuards.js","../src/LocalStoreX.js"],"sourcesContent":["/**\n * Checks if the given object conforms to the IStorageItem interface.\n *\n * @param {any} obj - The object to be checked.\n * @return {boolean} - Returns true if the object is an IStorageItem, otherwise false.\n */\nexport function isIStorageItem(obj) {\n    return obj &&\n        typeof obj === 'object' &&\n        typeof obj.version === 'string' &&\n        (typeof obj.expiration === 'number' || obj.expiration === null) &&\n        (typeof obj.value === 'object' || obj.value === 'string');\n}\n","import { isIStorageItem } from './type/TypeGuards';\nexport default class LocalStoreX {\n    /**\n     * Constructor for initializing the object with a version helper and an optional default expiration time.\n     * Also performs cleanup of expired items.\n     *\n     * @param {string} defaultVersion - An instance used to manage versioning of objects.\n     * @param {number} [defaultExpiration=null] - The default expiration time for items in seconds.\n     *\n     * @return {void}\n     */\n    constructor(defaultVersion = 'v1', defaultExpiration = null) {\n        Object.defineProperty(this, \"defaultVersion\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: defaultVersion\n        });\n        Object.defineProperty(this, \"defaultExpiration\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: defaultExpiration\n        });\n    }\n    /**\n     * Returns a singleton instance of the LocalStoreX class.\n     * If one does not already exist, it creates one with the provided configuration.\n     *\n     * @param {Object} [config] - Optional configuration object.\n     * @param {string} [config.defaultVersion='v1'] - Specifies the default version for the instance.\n     * @param {null} [config.defaultExpiration=null] - Specifies the default expiration for the instance.\n     * @return {LocalStoreX} The singleton instance of the LocalStoreX class.\n     */\n    static getInstance(config) {\n        if (!LocalStoreX.instance) {\n            const expiration = config?.defaultExpiration ?? null;\n            const version = config?.defaultVersion ?? 'v1';\n            LocalStoreX.instance = new LocalStoreX(version, expiration);\n        }\n        return LocalStoreX.instance;\n    }\n    /**\n     * Stores an item in the local storage with the specified key, data, and optional version and expiration.\n     *\n     * @param {string} key - The key under which the data will be stored.\n     * @param {any} data - The data to be stored.\n     * @param {number} [expiration] - Optional expiration time for the data in seconds.\n     * @param {string | number} [providedVersion] - Optional version information for the data.*\n     * @return {void}\n     */\n    setItem(key, data, expiration, providedVersion) {\n        const version = providedVersion || this.defaultVersion;\n        const existingItem = this.getExistingItem(key);\n        const updatedItem = existingItem\n            ? this.updateExistingItem(existingItem, data, version, expiration)\n            : this.createNewItem(data, expiration, version);\n        localStorage.setItem(key, JSON.stringify(updatedItem));\n    }\n    /**\n     * Retrieves an item from storage by its key and optional version.\n     *\n     * @param {string} key - The key of the item to retrieve.\n     * @param {string} [version] - Optional version to retrieve a specific version of the item.\n     * @return {*} The data stored under the given key and version, or null if the item does not exist or is expired.\n     */\n    getItem(key, version) {\n        const item = this.getExistingItem(key);\n        if (!item || this.isExpired(item.expiration)) {\n            localStorage.removeItem(key);\n            return null;\n        }\n        const actualVersion = version || this.defaultVersion;\n        if (item.version === actualVersion) {\n            return item.value;\n        }\n        return null;\n    }\n    /**\n     * Removes an item from the local storage based on the specified key.\n     *\n     * @param {string} key - The key of the item to be removed from local storage.\n     * @return {void} No return value.\n     */\n    removeItem(key) {\n        localStorage.removeItem(key);\n    }\n    /**\n     * Clears all key-value pairs stored in the local storage.\n     *\n     * @return {void} - No return value.\n     */\n    clear() {\n        localStorage.clear();\n    }\n    /**\n     * Retrieves an existing item from local storage.\n     *\n     * @param {string} key - The key under which the item is stored.\n     * @return {IStorageItem | null} The parsed item if found, otherwise null.\n     */\n    getExistingItem(key) {\n        try {\n            const item = localStorage.getItem(key);\n            if (!item)\n                return null;\n            const parsedItem = JSON.parse(item);\n            return isIStorageItem(parsedItem) ? parsedItem : null;\n        }\n        catch (error) {\n            console.warn(`Error parsing JSON for key \"${key}\":`, error);\n            return null;\n        }\n    }\n    /**\n     * Creates a new storage item with the given version and optional expiration time.\n     *\n     * @param {any} data - The data to be stored.\n     * @param {number} [expiration] - Optional expiration time in seconds. If provided, the expiration\n     * @param {string} [version] - The version of the new storage item.\n     * @return {IStorageItem} The newly created storage item.\n     */\n    createNewItem(data, expiration, version) {\n        return {\n            version: version ?? this.defaultVersion,\n            expiration: expiration ? Date.now() + expiration * 1000 : this.defaultExpiration,\n            value: data\n        };\n    }\n    /**\n     * Updates an existing storage item with new data, version, and expiration time.\n     *\n     * @param {IStorageItem} existingItem - The existing item to update.\n     * @param {any} data - The new data to store.\n     * @param {string} version - The version to set for the item.\n     * @param {number} [expiration] - Optional expiration time for the item in seconds.\n     * @returns {IStorageItem} Returns the updated item.\n     */\n    updateExistingItem(existingItem, data, version, expiration) {\n        return {\n            ...existingItem,\n            version,\n            value: data,\n            expiration: expiration ? Date.now() + expiration * 1000 : existingItem.expiration,\n        };\n    }\n    /**\n     * Checks whether the given expiration timestamp has passed.\n     *\n     * @param {number | null} expiration - The timestamp to check for expiration, or null to indicate no expiration.\n     * @return {boolean} Returns true if the current time is greater than the expiration time, false otherwise.\n     */\n    isExpired(expiration) {\n        return expiration !== null && Date.now() > expiration;\n    }\n}\n"],"names":[],"mappings":"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"}